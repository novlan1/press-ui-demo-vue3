import{_ as e,o as t,c as s,k as r,j as i,y as a,v as l,F as o,t as n,a as c,w as d,u,ab as h,ac as p,d as v}from"./index-26897e9f.js";import{W as m,B as y}from"./color.3a05f6e0.js";import{e as C,d as f}from"./version.066ec1d4.js";import{c as g}from"./press-component.5db9b2cc.js";import{i as x,u as S}from"./utils.f8cec38d.js";import{P as w}from"./press-button.68ee5a84.js";import"./add-unit.e5b08e9d.js";import"./press-icon-plus.cec3bc23.js";import"./press-info.8af1a743.js";import"./press-loading-plus.3f0fdd35.js";import"./press-loading.59b8bf61.js";import"./button.3e831465.js";function k(e){return Object.assign(e,{setStrokeStyle(t){e.strokeStyle=t},setLineWidth(t){e.lineWidth=t},setLineCap(t){e.lineCap=t},setFillStyle(t){e.fillStyle=t},setFontSize(t){e.font=String(t)},setGlobalAlpha(t){e.globalAlpha=t},setLineJoin(t){e.lineJoin=t},setTextAlign(t){e.textAlign=t},setMiterLimit(t){e.miterLimit=t},setShadow(t,s,r,i){e.shadowOffsetX=t,e.shadowOffsetY=s,e.shadowBlur=r,e.shadowColor=i},setTextBaseline(t){e.textBaseline=t},createCircularGradient(){},draw(){}})}let b=0;const I=2*Math.PI,_=-Math.PI/2;const j=e({i18n:{"zh-CN":{gradient:"渐变色",customSize:"大小定制",customStyle:"样式定制",customColor:"颜色定制",customWidth:"宽度定制",counterClockwise:"逆时针"},"en-US":{gradient:"Gradient",customSize:"Size",customStyle:"Custom Style",customColor:"Color",customWidth:"Width",counterClockwise:"Direction"}},components:{PressCircle:e({name:"PressCircle",props:{text:{type:String,default:""},lineCap:{type:String,default:"round"},value:{type:Number,default:0},speed:{type:Number,default:50},size:{type:Number,default:100},fill:{type:String,default:""},layerColor:{type:String,default:m},color:{type:null,default:y},type:{type:String,default:""},strokeWidth:{type:Number,default:4},clockwise:{type:Boolean,default:!0}},emits:[],data:()=>({hoverColor:y,id:1,isNotInUni:x()}),computed:{circleStyle(){const{size:e}=this;return`width: ${S.addUnit(e)};height: ${S.addUnit(e)}`},canvasId(){return`press-circle-${this.id}`}},watch:{value:{handler(){this.reRender()}},size:{handler(){this.drawCircle(this.currentValue)}},color:{handler(){this.setHoverColor().then((()=>{this.drawCircle(this.currentValue)}))}}},created(){b+=1,this.id=b},mounted(){this.currentValue=this.value,this.setHoverColor().then((()=>{this.drawCircle(this.currentValue)}))},destroyed(){this.onDestroyed()},unmounted(){this.onDestroyed()},methods:{onDestroyed(){this.clearMockInterval()},getContext(){const{type:e,size:t}=this;if(x()){const e=window.devicePixelRatio,s=document.getElementById(this.canvasId),r=s.getContext("2d");return this.inited||(this.inited=!0,s.width=t*e,s.height=t*e,r.scale(e,e)),Promise.resolve(k(r))}if(""===e||!C()){const e=uni.createCanvasContext(this.canvasId,this);return Promise.resolve(e)}const s=f().pixelRatio;return new Promise((r=>{uni.createSelectorQuery().in(this).select(`#${this.canvasId}`).node().exec((i=>{const a=i[0].node,l=a.getContext(e);this.inited||(this.inited=!0,a.width=t*s,a.height=t*s,l.scale(s,s)),r(k(l))}))}))},setHoverColor(){const{color:e,size:t}=this;return g(e)?this.getContext().then((s=>{const r=s.createLinearGradient(t,0,0,0);Object.keys(e).sort(((e,t)=>parseFloat(e)-parseFloat(t))).map((t=>r.addColorStop(parseFloat(t)/100,e[t]))),this.hoverColor=r})):(this.hoverColor=e,Promise.resolve())},presetCanvas(e,t,s,r,i){const{strokeWidth:a,lineCap:l,clockwise:o,size:n}=this,c=n/2,d=c-a/2;e.setStrokeStyle(t),e.setLineWidth(a),e.setLineCap(l),e.beginPath(),e.arc(c,c,d,s,r,!o),e.stroke(),i&&(e.setFillStyle(i),e.fill())},renderLayerCircle(e){const{layerColor:t,fill:s}=this;this.presetCanvas(e,t,0,I,s)},renderHoverCircle(e,t){const{clockwise:s}=this,r=I*(t/100),i=s?_+r:3*Math.PI-(_+r);this.presetCanvas(e,this.hoverColor,_,i)},drawCircle(e){const{size:t}=this;this.getContext().then((s=>{s.clearRect(0,0,t,t),this.renderLayerCircle(s);const r=(i=e,Math.min(Math.max(i,0),100));var i;0!==r&&this.renderHoverCircle(s,r),s.draw()}))},reRender(){const{value:e,speed:t}=this;if(t<=0||t>1e3)return void this.drawCircle(e);this.clearMockInterval(),this.currentValue=this.currentValue||0;const s=()=>{this.interval=setTimeout((()=>{this.currentValue!==e?(Math.abs(this.currentValue-e)<1?this.currentValue=e:this.currentValue<e?this.currentValue+=1:this.currentValue-=1,this.drawCircle(this.currentValue),s()):this.clearMockInterval()}),1e3/t)};s()},clearMockInterval(){this.interval&&(clearTimeout(this.interval),this.interval=null)}}},[["render",function(e,v,m,y,C,f){const g=h,x=p;return t(),s("div",{class:"press-circle-index"},[r("div",{class:"press-circle"},[i(g,{id:f.canvasId,class:"press-circle__canvas",type:m.type,style:a(f.circleStyle),"canvas-id":f.canvasId},null,8,["id","type","style","canvas-id"]),m.text?(t(),s(o,{key:1},[C.isNotInUni?(t(),s("div",{key:0,class:"press-circle__text"},n(m.text),1)):(t(),c(x,{key:1,class:"press-circle__text"},{default:d((()=>[u(n(m.text),1)])),_:1}))],64)):(t(),s("div",{key:0,class:"press-circle__text"},[l(e.$slots,"default",{},void 0,!0)]))])])}],["__scopeId","data-v-a16c60ae"]]),PressButton:w},data:()=>({value:20,headerStyle:"background: #f7f8fa;",sectionStyle:"background: #f7f8fa;margin: 0;padding: 0 12px;",gradientColor:{"0%":"#3fecff","100%":"#6149f6"}}),methods:{onChangeCircleValue(e){if("plus"===e){if(this.value>=100)return;this.value+=20}else if("minus"===e){if(this.value<=0)return;this.value-=20}}}},[["render",function(e,a,l,o,c,h){const p=v("press-circle"),m=v("demo-block"),y=v("press-button");return t(),s("div",{class:"demo-wrap demo-wrap--gray"},[i(m,{title:e.t("basicUsage"),"header-style":c.headerStyle,"section-style":c.sectionStyle},{default:d((()=>[i(p,{value:c.value,text:`${c.value}%`},null,8,["value","text"])])),_:1},8,["title","header-style","section-style"]),i(m,{title:e.t("customStyle"),"header-style":c.headerStyle,"section-style":c.sectionStyle},{default:d((()=>[r("div",{class:"demo-part"},[i(p,{value:c.value,"stroke-width":6,text:e.t("customWidth")},null,8,["value","text"])]),r("div",{class:"demo-part"},[i(p,{value:c.value,"stroke-width":6,"layer-color":"#eeeeee",color:"#ee0a24",text:e.t("customColor")},null,8,["value","text"])]),r("div",{class:"demo-part"},[i(p,{value:c.value,"stroke-width":6,color:c.gradientColor,text:e.t("gradient")},null,8,["value","color","text"])]),r("div",{class:"demo-part"},[i(p,{value:c.value,"stroke-width":6,color:"#07c160",clockwise:!1,text:e.t("counterClockwise")},null,8,["value","text"])]),r("div",{class:"demo-part"},[i(p,{value:c.value,size:120,text:e.t("customSize")},null,8,["value","text"])]),r("div",null,[i(y,{type:"e-sport-primary","custom-style":"margin-right:8px;",onClick:a[0]||(a[0]=e=>h.onChangeCircleValue("plus"))},{default:d((()=>[u(n(e.t("add")),1)])),_:1}),i(y,{type:"e-sport-primary",onClick:a[1]||(a[1]=e=>h.onChangeCircleValue("minus"))},{default:d((()=>[u(n(e.t("decrease")),1)])),_:1})])])),_:1},8,["title","header-style","section-style"])])}],["__scopeId","data-v-c939b837"]]);export{j as default};
