import{p as t,a as i,i as e}from"./utils.dccf1609.js";import{_ as s,o as a,c as o,r as n,a as m,t as r,F as h,h as d}from"./index-5bc1d01b.js";function c(t){return setTimeout(t,30)}const u=s({name:"PressCountDown",props:{useSlot:Boolean,millisecond:Boolean,time:{type:Number,default:0},format:{type:String,default:"HH:mm:ss"},autoStart:{type:Boolean,default:!0}},emits:["change","finish"],data:()=>({formattedTime:"0",remain:0}),computed:{timeData(){return t(this.remain)}},watch:{time:{handler(t){const{remain:i,millisecond:e}=this;(e||Math.floor(t/1e3)!==Math.floor(i/1e3)&&Math.round(t/1e3)!==Math.round(i/1e3))&&this.reset()},immediate:!0}},destroyed(){this.onDestroyed()},unmounted(){this.onDestroyed()},methods:{onDestroyed(){clearTimeout(this.tid),this.tid=null},start(){this.counting||(this.counting=!0,this.endTime=Date.now()+this.remain,this.tick())},pause(){this.counting=!1,clearTimeout(this.tid)},reset(){this.pause(),this.remain=this.time,this.setRemain(this.remain),this.autoStart&&this.start()},tick(){this.millisecond?this.microTick():this.macroTick()},microTick(){this.tid=c((()=>{this.setRemain(this.getRemain()),0!==this.remain&&this.microTick()}))},macroTick(){this.tid=c((()=>{const t=this.getRemain();e(t,this.remain)&&0!==t||this.setRemain(t),0!==this.remain&&this.macroTick()}))},getRemain(){return Math.max(this.endTime-Date.now(),0)},setRemain(e){this.remain=e;const s=t(e);this.useSlot&&this.$emit("change",s),this.formattedTime=i(this.format,s),0===e&&(this.pause(),this.$emit("finish"))}}},[["render",function(t,i,e,s,c,u){return a(),o("div",{class:"press-count-down"},[e.useSlot?n(t.$slots,"default",{key:0,timeData:u.timeData},(()=>[m("span",null,r(c.formattedTime),1)]),!0):(a(),o(h,{key:1},[d(r(c.formattedTime),1)],64))])}],["__scopeId","data-v-dbf1d5c0"]]);export{u as P};
