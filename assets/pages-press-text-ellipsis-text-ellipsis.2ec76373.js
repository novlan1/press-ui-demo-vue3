import{_ as t,u as e,o as i,c as n,h as s,t as o,r as a,d as l,a as d,b as r,i as c,j as p,e as h}from"./index-19b2bbb6.js";let u=0;const x=t({i18n:{"zh-CN":{text:"慢慢来，不要急，生活给你出了难题，可也终有一天会给出答案。",text2:"似水流年是一个人所有的一切，只有这个东西，才真正归你所有。其余的一切，都是片刻的欢娱和不幸，转眼间就已跑到那似水流年里去了。",text3:"那一天我二十一岁，在我一生的黄金时代。我有好多奢望。我想爱，想吃，还想在一瞬间变成天上半明半暗的云。后来我才知道，生活就是个缓慢受锤的过程，人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。可是我过二十一岁生日时没有预见到这一点。我觉得自己会永远生猛下去，什么也锤不了我。",expandText:"展开",collapseText:"收起",expandCollapse:"展开/收起",customRows:"自定义展示行数",collapsePosition:"自定义省略位置",collapseStart:"头部省略",collapseMiddle:"中部省略",customAction:"自定义操作内容"},"en-US":{text:"Take your time and be patient. Life itself will eventually answer all those questions it once raised for you.",text2:"The fleeting time of one's life is everything that belongs to a person. Only this thing truly belongs to you. Everything else is just a momentary pleasure or misfortune, which will soon be gone with the passing of time.",text3:"That day, I turned twenty-one. In the golden age of my life, I was full of dreams. I wanted to love, to eat, and to instantly transform into one of these clouds, part alight, part darkened. It was only later that I understood life is but a slow, drawn-out process of getting your balls crushed. Day by day, you get older. Day by day, your dreams fade. In the end you are no different from a crushed ox. But I hadn't foreseen any of it on my twenty-first birthday. I thought I would be vigorous forever, and that nothing could ever crush me.",expandText:"expand",collapseText:"collapse",expandCollapse:"Expand/Collapse",customRows:"Customize Rows",collapsePosition:"Custom Collapse Position",collapseStart:"Head Area Collapse Position",collapseMiddle:"Middle Area Collapse Position",customAction:"Custom Action"}},components:{PressTextEllipsis:t({name:"PressTextEllipsis",props:{rows:{type:[Number,String],default:1},dots:{type:String,default:"..."},content:{type:String,default:""},expandText:{type:String,default:""},collapseText:{type:String,default:""},position:{type:String,default:"end"},useActionSlot:{type:Boolean,default:!1},adjustString:{type:[Object,String],default:()=>({end:"a",start:"a",middle:"aa"})}},data(){return{text:this.content,expanded:!1,hasAction:!1,needRecalculate:!1,hideText:this.content,id:"hideDom-0"}},computed:{innerAdjustString(){return"string"==typeof this.adjustString?this.adjustString:this.adjustString[this.position]},hideStyle:()=>e({position:"fixed",zIndex:"-9999",top:"-9999px",height:"auto",minHeight:"auto",maxHeight:"auto"}),actionText(){return this.expanded?this.collapseText:this.expandText}},watch:{content:{handler(t){this.calcEllipsised(),this.hideText=t}},rows:"calcEllipsised",position:"calcEllipsised"},mounted(){this.calcEllipsised(),u+=1,this.id=`hideDom-${u}`,this.useActionSlot&&setTimeout((()=>{this.calcEllipsised()})),window.addEventListener("resize",this.watchResize,{passive:!0}),window.addEventListener("orientationchange",this.watchResize,{passive:!0})},activated(){this.needRecalculate&&(this.needRecalculate=!1,this.calcEllipsised())},beforeDestroy(){this.onBeforeUnMount()},beforeUnmount(){this.onBeforeUnMount()},methods:{onBeforeUnMount(){window.removeEventListener("resize",this.watchResize),window.removeEventListener("orientationchange",this.watchResize)},watchResize(){this.calcEllipsised()},pxToNum(t){if(!t)return 0;const e=`${t}`.match(/^\d*(\.\d*)?/);return e?Number(e[0]):0},updateContainer(t,e,i){t[e]=i},getContainerHeight(t){let e;return e=Promise.resolve({offsetHeight:t.offsetHeight,paddingTop:t.style.paddingBottom,paddingBottom:t.style.paddingTop,lineHeight:t.style.lineHeight}),e},cloneContainer(){if(!this.$refs.root||!this.$refs.root.isConnected)return;const t=window.getComputedStyle(this.$refs.root),e=document.createElement("div");return Array.prototype.slice.apply(t).forEach((i=>{e.style.setProperty(i,t.getPropertyValue(i))})),e.style.position="fixed",e.style.zIndex="-9999",e.style.top="-9999px",e.style.height="auto",e.style.minHeight="auto",e.style.maxHeight="auto",e.innerText=this.content,document.body.appendChild(e),e},async calcEllipsisText(t,e){var i;const{content:n,position:s,dots:o}=this,a=n.length,l=0+a>>1,d=this.useActionSlot?(null==(i=this.$refs.actionRef)?void 0:i.outerHTML)??"":this.expandText,r=async(i,s)=>{if(i[1]-i[0]<=1&&s[1]-s[0]<=1)return n.slice(0,i[0])+o+n.slice(s[1],a);const l=Math.floor((i[0]+i[1])/2),c=Math.ceil((s[0]+s[1])/2),p=this.content.slice(0,l)+this.dots+this.content.slice(c,a);this.updateContainer(t,"innerText",p);let h=p+this.innerAdjustString+d;h=t.innerHTML+d,this.updateContainer(t,"innerHTML",h);const{offsetHeight:u}=await this.getContainerHeight(t);return u>=e?await r([i[0],l],[c,s[1]]):await r([l,i[1]],[s[0],c])};return"middle"===this.position?await r([0,l],[l,a]):await(async()=>{const i=async(l,r)=>{if(r-l<=1)return"end"===s?n.slice(0,l)+o:o+n.slice(r,a);const c=Math.round((l+r)/2);let p="";p="end"===s?n.slice(0,c)+o:o+n.slice(c,a),this.updateContainer(t,"innerText",p);let h=p+this.innerAdjustString+d;h=t.innerHTML+d,this.updateContainer(t,"innerHTML",h);const{offsetHeight:u}=await this.getContainerHeight(t);return u>e?"end"===s?await i(l,c):await i(c,r):"end"===s?await i(c,r):await i(l,c)};return await i(0,a)})()},async calcEllipsised(){let t={offsetHeight:0,innerHTML:"",innerText:""};if(t=this.cloneContainer(),!t)return void(this.needRecalculate=!0);const e=await this.getContainerHeight(t),{paddingBottom:i,paddingTop:n,lineHeight:s,offsetHeight:o}=e,a=Math.ceil((Number(this.rows)+.5)*this.pxToNum(s)+this.pxToNum(n)+this.pxToNum(i));a<o?(this.hasAction=!0,this.text=await this.calcEllipsisText(t,a)):(this.hasAction=!1,this.text=this.content),document.body.removeChild(t)},toggle(t=!this.expanded){this.expanded=t},onClickAction(t){this.toggle(),this.$emit("clickAction",t)},getHideDom(){return new Promise((t=>{uni.createSelectorQuery().in(this).select(`#${this.id}`).fields({size:!0,computedStyle:["lineHeight","paddingBottom","paddingTop"]},(e=>{console.log("res",e),t(e)})).exec()}))},updateHideText(t){this.hideText=t}}},[["render",function(t,e,c,p,h,u){return i(),n("div",{ref:"root",class:"press-text-ellipsis"},[s(o(h.expanded?c.content:h.text)+" ",1),h.hasAction?(i(),n("span",{key:0,ref:"actionRef",class:"press-text-ellipsis__action",onClick:e[0]||(e[0]=(...t)=>u.onClickAction&&u.onClickAction(...t))},[a(t.$slots,"action",{expanded:h.expanded},(()=>[s(o(u.actionText),1)]),!0),l(' <template v-if="useActionSlot">\n        <slot\n          name="action"\n          :expanded="expanded"\n        />\n      </template>\n      <template v-else>{{ actionText }}</template> ')],512)):l("v-if",!0),d("div",{id:h.id,style:r(u.hideStyle),class:"press-text-ellipsis"},o(h.hideText),13,["id"])],512)}],["__scopeId","data-v-f5029686"]])},data:()=>({headerStyle:"margin-top: 10px;"}),computed:{},mounted(){},methods:{}},[["render",function(t,e,a,l,d,r){const u=h("PressTextEllipsis"),x=h("demo-block");return i(),n("div",{class:"demo-wrap"},[c(x,{title:t.t("basicUsage")},{default:p((()=>[c(u,{content:t.t("text")},null,8,["content"])])),_:1},8,["title"]),c(x,{title:t.t("expandCollapse"),"header-style":d.headerStyle},{default:p((()=>[c(u,{content:t.t("text2"),"expand-text":t.t("expandText"),"collapse-text":t.t("collapseText")},null,8,["content","expand-text","collapse-text"])])),_:1},8,["title","header-style"]),c(x,{title:t.t("customRows"),"header-style":d.headerStyle},{default:p((()=>[c(u,{rows:"3",content:t.t("text3"),"expand-text":t.t("expandText"),"collapse-text":t.t("collapseText"),"adjust-string":"aaaaa"},null,8,["content","expand-text","collapse-text"])])),_:1},8,["title","header-style"]),c(x,{title:t.t("collapseStart"),"header-style":d.headerStyle},{default:p((()=>[c(u,{rows:"1",content:t.t("text3"),"expand-text":t.t("expandText"),"collapse-text":t.t("collapseText"),position:"start"},null,8,["content","expand-text","collapse-text"])])),_:1},8,["title","header-style"]),c(x,{title:t.t("collapseMiddle"),"header-style":d.headerStyle},{default:p((()=>[c(u,{rows:"2",content:t.t("text3"),"expand-text":t.t("expandText"),"collapse-text":t.t("collapseText"),position:"middle"},null,8,["content","expand-text","collapse-text"])])),_:1},8,["title","header-style"]),c(x,{title:t.t("customAction"),"header-style":d.headerStyle},{default:p((()=>[c(u,{content:t.t("text"),"use-action-slot":!0},{action:p((({expanded:e})=>[s(o(e?t.t("collapseText"):t.t("expandText")),1)])),_:1},8,["content"])])),_:1},8,["title","header-style"])])}]]);export{x as default};
