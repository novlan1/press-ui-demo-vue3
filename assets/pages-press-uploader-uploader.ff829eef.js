import{_ as e,o as t,c as i,i as s,F as a,p as o,j as l,q as n,h as r,t as c,f as d,x as u,r as p,n as m,z as f,e as g,w as h}from"./index-5dfad55c.js";import{a as y,i as v}from"./utils.be600cd3.js";import{a as b}from"./add-unit.31f60370.js";import{P as x}from"./press-icon-plus.62d17a35.js";import{P as w}from"./press-loading-plus.a24c0441.js";import{i as _,v as k,f as R,p as j}from"./test.b328066d.js";import{P}from"./press-image.644b675c.js";import"./style.0f94ff97.js";import"./press-info.582ccb17.js";import"./press-component.c6e26072.js";import"./press-transition.25f6f4c0.js";import"./version.d929b690.js";import"./adapter.aca28c8f.js";const z={image:{jpg:"jpeg",jpe:"jpeg",pbm:"x-portable-bitmap",pgm:"x-portable-graymap",pnm:"x-portable-anymap",ppm:"x-portable-pixmap",psd:"vnd.adobe.photoshop",pic:"x-pict",rgb:"x-rgb",svg:"svg+xml",svgz:"svg+xml",tif:"tiff",xif:"vnd.xiff",wbmp:"vnd.wap.wbmp",wdp:"vnd.ms-photo",xbm:"x-xbitmap",ico:"x-icon"},video:{"3g2":"3gpp2","3gp":"3gpp",avi:"x-msvideo",f4v:"x-f4v",flv:"x-flv",jpgm:"jpm",jpgv:"jpeg",m1v:"mpeg",m2v:"mpeg",mpe:"mpeg",mpg:"mpeg",mpg4:"mpeg",m4v:"x-m4v",mkv:"x-matroska",mov:"quicktime",qt:"quicktime",movie:"x-sgi-movie",mp4v:"mp4",ogv:"ogg",smv:"x-smv",wm:"x-ms-wm",wmv:"x-ms-wmv",wmx:"x-ms-wmx",wvx:"x-ms-wvx"}},L="*";function S({count:e,sourceType:t,type:i,extension:s=["*"]}){const a=document.createElement("input");return a.type="file",y(a,{position:"absolute",visibility:"hidden","z-index":-999,width:0,height:0,top:0,left:0}),a.accept=s.map((e=>{if(i!==L){const t=e.replace(".","");return`${i}/${z[i][t]||t}`}return function(){const e=window.navigator.userAgent.toLowerCase();return!(!e.match(/MicroMessenger/i)||"micromessenger"!==e.match(/MicroMessenger/i)[0])}()?".":0===e.indexOf(".")?e:`.${e}`})).join(","),e>1&&(a.multiple="multiple"),1===t.length&&"camera"===t[0]&&(a.capture="camera"),a}const{hasOwnProperty:C}=Object.prototype;function F(e,t){return C.call(e,t)}const T={};function I(e){for(const i in T)if(F(T,i)){if(T[i]===e)return i}const t=(window.URL||window.webkitURL).createObjectURL(e);return T[t]=e,t}function D(e){(window.URL||window.webkitURL).revokeObjectURL(e),delete T[e]}function O(e,t){const i=[],s=e.target.files.length;for(let a=0;a<s;a++){const s=e.target.files[a];let o;Object.defineProperty(s,"path",{get:()=>(o=o||I(s),o)}),a<t&&i.push(s)}return i}let A=null;let U=null;let M=null;function $({count:e,success:t,fail:i,type:s}){if(v())return function({count:e,sourceType:t,type:i,extension:s,success:a}){A&&(document.body.removeChild(A),A=null),A=S({count:e,sourceType:t,type:i,extension:s}),document.body.appendChild(A),A.addEventListener("change",(t=>{const i=O(t,e);a({errMsg:"chooseFile:ok",get tempFilePaths(){return i.map((({path:e})=>e))},tempFiles:i})})),A.click()}({count:e,sourceType:[],type:s,extension:["*"],success:t});uni.chooseFile({count:e,type:s,success:t,fail:i})}function B({count:e,sourceType:t,sizeType:i,success:s,fail:a}){if(v())return function({count:e,sourceType:t,extension:i,success:s}){U&&(document.body.removeChild(U),U=null),U=S({count:e,sourceType:t,extension:i,type:"image"}),document.body.appendChild(U),U.addEventListener("change",(t=>{const i=O(t,e);s({errMsg:"chooseImage:ok",get tempFilePaths(){return i.map((({path:e})=>e))},tempFiles:i})})),U.click()}({count:e,sourceType:t,extension:["*"],success:s});uni.chooseImage({count:e,sourceType:t,sizeType:i,success:s,fail:a})}function V({sourceType:e,success:t,fail:i,compressed:s,maxDuration:a,camera:o}){if(v())return function({sourceType:e,extension:t,success:i}){M&&(document.body.removeChild(M),M=null),M=S({sourceType:e,extension:t,type:"video"}),document.body.appendChild(M),M.addEventListener("change",(e=>{const t=e.target.files[0],s={errMsg:"chooseVideo:ok",tempFile:t,size:t.size,duration:0,width:0,height:0,name:t.name};let a;Object.defineProperty(s,"tempFilePath",{get(){return a=a||I(this.tempFile),a}});const o=document.createElement("video");if(void 0!==o.onloadedmetadata){const e=I(t);o.onloadedmetadata=function(){D(e),i(Object.assign(s,{duration:o.duration||0,width:o.videoWidth||0,height:o.videoHeight||0}))},setTimeout((()=>{o.onloadedmetadata=null,D(e),i(s)}),300),o.src=e}else i(s)})),M.click()}({sourceType:e,extension:["*"],success:t});uni.chooseVideo({sourceType:e,success:t,fail:i,compressed:s,maxDuration:a,camera:o})}function N(e){return e.tempFiles}const q={watch:{accept:{immediate:!0,handler(e){"all"!==e&&"media"!==e||console.warn("只有微信小程序才支持把 accept 配置为 all、media 之一")}}}},E={props:{accept:{type:String,default:"image"},capture:{type:[String,Array],default:()=>["album","camera"]},compressed:{type:Boolean,default:!0},camera:{type:String,default:"back"},maxDuration:{type:Number,default:60},uploadIcon:{type:String,default:"photograph"},uploadIconColor:{type:String,default:"#D3D4D6"},useBeforeRead:{type:Boolean,default:!1},afterRead:{type:Function,default:null},beforeRead:{type:Function,default:null},previewFullImage:{type:Boolean,default:!0},maxCount:{type:[String,Number],default:52},disabled:{type:Boolean,default:!1},imageMode:{type:String,default:"aspectFill"},name:{type:String,default:"file"},sizeType:{type:Array,default:()=>["original","compressed"]},multiple:{type:Boolean,default:!1},deletable:{type:Boolean,default:!0},maxSize:{type:[String,Number],default:Number.MAX_VALUE},fileList:{type:Array,default:()=>[]},uploadText:{type:String,default:""},width:{type:[String,Number],default:80},height:{type:[String,Number],default:80},previewImage:{type:Boolean,default:!0},customStyle:{type:String,default:""}}};const G="https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/10/own_mike_a17f94292a34e9f644.jpeg";let H;const K=e({i18n:{"zh-CN":{uploadVideo:"上传视频",uploadStatus:"上传状态",preview:"文件预览",maxCount:"限制上传数量",maxSize:"限制上传大小",customStyle:"自定义上传样式",beforeRead:"上传前置处理"},"en-US":{uploadVideo:"Upload Video",uploadStatus:"Upload Status",preview:"Preview",maxCount:"Max Count",maxSize:"Max Size",customStyle:"Custom Style",beforeRead:"Before Read"}},components:{PressUploader:e({name:"PressUploader",options:{virtualHost:!0,styleIsolation:"shared"},components:{PressIconPlus:x,PressLoadingPlus:w},mixins:[q,E],emits:["afterRead","error","oversize"],data:()=>({lists:[],isInCount:!0,isNotInUni:v()}),watch:{fileList:{immediate:!0,handler(){this.formatFileList()}}},methods:{addUnit:b,formatFileList(){const{fileList:e=[],maxCount:t}=this,i=e.map((e=>Object.assign(Object.assign({},e),{isImage:"image"===this.accept||_(e.url||e.thumb),isVideo:"video"===this.accept||k(e.url||e.thumb),deletable:"boolean"==typeof e.deletable?e.deletable:this.deletable})));this.lists=i,this.isInCount=i.length<t},chooseFile(){const{maxCount:e,multiple:t,lists:i,disabled:s}=this;if(console.log("[chooseFile]"),s)return;let a;try{a=Array.isArray(this.capture)?this.capture:this.capture.split(",")}catch(o){a=[]}(function({accept:e,multiple:t,capture:i,compressed:s,maxDuration:a,sizeType:o,camera:l,maxCount:n}){return new Promise(((r,c)=>{switch(e){case"image":B({count:t?Math.min(n,9):1,sourceType:i,sizeType:o,success:e=>r(function(e){return e.tempFiles}(e)),fail:c});break;case"video":V({sourceType:i,compressed:s,maxDuration:a,camera:l,success:e=>r(e),fail:c});break;case"file":$({count:t?n:1,type:e,success:e=>r(N(e)),fail:c});break;default:$({count:t?n:1,type:"all",success:e=>r(N(e)),fail:c})}}))})(Object.assign({accept:this.accept,multiple:this.multiple,capture:a,compressed:this.compressed,maxDuration:this.maxDuration,sizeType:this.sizeType,camera:this.camera},{maxCount:e-i.length})).then((e=>{this.onBeforeRead(t?e:e[0])})).catch((e=>{this.$emit("error",e)}))},onBeforeRead(e){const{beforeRead:t,useBeforeRead:i}=this;let s=!0;R(t)&&(s=t(e,this.getDetail())),i&&(s=new Promise(((t,i)=>{this.$emit("beforeRead",Object.assign(Object.assign({file:e},this.getDetail()),{callback:e=>{e?t():i()}}))}))),s&&(j(s)?s.then((t=>this.onAfterRead(t||e))):this.onAfterRead(e))},getDetail(e){return{name:this.name,index:null==e?this.fileList.length:e}},onAfterRead(e){const{maxSize:t,afterRead:i}=this;(Array.isArray(e)?e.some((e=>e.size>t)):e.size>t)?this.$emit("oversize",Object.assign({file:e},this.getDetail())):("function"==typeof i&&i(e,this.getDetail()),this.$emit("afterRead",Object.assign({file:e},this.getDetail())))},deleteItem(e){this.$emit("delete",Object.assign(Object.assign({},this.getDetail(e)),{file:this.fileList[e]}))},onPreviewImage(e){e.isImage&&this.previewFullImage&&uni.previewImage({urls:this.lists.filter((e=>"image"===this.accept||_(e.url||e.thumb))).map((e=>e.url||e.thumb)),current:e.url||e.thumb,fail(){}})},onPreviewVideo(e){if(!this.data.previewFullImage)return;const{index:t}=e.currentTarget.dataset,{lists:i}=this.data;wx.previewMedia({sources:i.map((e=>Object.assign(Object.assign({},e),{type:"video"}))),current:t,fail(){}})},onClickPreview(e){const{index:t}=e.currentTarget.dataset,i=this.data.lists[t];this.$emit("clickPreview",Object.assign(Object.assign({},i),this.getDetail(t)))}}},[["render",function(e,h,y,v,b,x){const w=f,_=g("PressIconPlus"),k=g("PressLoadingPlus");return t(),i("div",{class:"press-upload",style:l(e.customStyle)},[s("div",{class:"press-upload__wrap"},[e.previewImage?(t(!0),i(a,{key:0},o(b.lists,((o,p)=>(t(),i("div",{key:p,class:"press-upload__wrap__preview"},[o.isImage||o.type&&"image"===o.type?(t(),i(a,{key:0},[b.isNotInUni?(t(),i("img",{key:0,src:o.thumb||o.url,mode:e.imageMode,class:"press-upload__wrap__preview__image",style:l([{width:x.addUnit(e.width),height:x.addUnit(e.height)}]),onClick:e=>x.onPreviewImage(o)},null,12,["src","mode","onClick"])):(t(),n(w,{key:1,src:o.thumb||o.url,mode:e.imageMode,class:"press-upload__wrap__preview__image",style:l([{width:x.addUnit(e.width),height:x.addUnit(e.height)}]),onClick:e=>x.onPreviewImage(o)},null,8,["src","mode","style","onClick"]))],64)):(t(),i("div",{key:1,class:"press-upload__wrap__preview__other"},[r(_,{color:"#80CBF9",size:"26",name:o.isVideo||o.type&&"video"===o.type?"movie":"folder"},null,8,["name"]),s("span",{class:"press-upload__wrap__preview__other__text"},c(o.isVideo||o.type&&"video"===o.type?"视频":"文件"),1)])),"uploading"===o.status||"failed"===o.status?(t(),i("div",{key:2,class:"press-upload__status"},[s("div",{class:"press-upload__status__icon"},["failed"===o.status?(t(),n(_,{key:0,name:"close",color:"#ffffff",size:"22"})):(t(),n(k,{key:1,size:"22",mode:"circle",color:"#ffffff"}))]),o.message?(t(),i("span",{key:0,class:"press-upload__status__message"},c(o.message),1)):d("v-if",!0)])):d("v-if",!0),"uploading"!==o.status&&(e.deletable||o.deletable)?(t(),i("div",{key:3,class:"press-upload__deletable",onClick:u((e=>x.deleteItem(p)),["stop"])},[d(' <div class="press-upload__deletable__icon"> '),r(_,{name:"cross",color:"#ffffff",size:"16","custom-class":"press-upload__deletable__icon"}),d(" </div> ")],8,["onClick"])):d("v-if",!0),(o.status,d("v-if",!0))])))),128)):d("v-if",!0),b.isInCount?(t(),i(a,{key:1},[e.$slots.default||e.$slots.$default?(t(),i("div",{key:0,onClick:h[0]||(h[0]=(...e)=>x.chooseFile&&x.chooseFile(...e))},[p(e.$slots,"default",{},void 0,!0)])):(t(),i("div",{key:1,class:m(["press-upload__button",[e.disabled&&"press-upload__button--disabled"]]),"hover-class":e.disabled?"":"press-upload__button--hover","hover-stay-time":"150",style:l([{width:x.addUnit(e.width),height:x.addUnit(e.height)}]),onClick:h[1]||(h[1]=u(((...e)=>x.chooseFile&&x.chooseFile(...e)),["stop"]))},[r(_,{name:e.uploadIcon,size:"26",color:e.uploadIconColor,onClick:x.chooseFile},null,8,["name","color","onClick"]),e.uploadText?(t(),i("span",{key:0,class:"press-upload__button__text"},c(e.uploadText),1)):d("v-if",!0)],14,["hover-class"]))],64)):d("v-if",!0)])],4)}],["__scopeId","data-v-11cecdb4"]]),PressImage:P},data:()=>({fileList1:[],fileListMaxSize:[],fileList2:[],fileList3:[{url:G}],fileList4:[{url:G},{url:G}],fileList6:[],fileListStatus:[{url:G,status:"uploading",message:"上传中..."},{url:G,status:"failed",message:"上传失败"}]}),mounted(){H=this},methods:{deletePic(e){console.log("[deletePic] event",e),this[`fileList${e.name}`].splice(e.index,1)},async afterRead(e){console.log("[afterRead] event",e);const t=[].concat(e.file);let i=this[`fileList${e.name}`].length;t.map((t=>{this[`fileList${e.name}`].push({...t,status:"uploading",message:"上传中"})}));for(let s=0;s<t.length;s++){const a=await this.uploadFilePromise(t[s].path),o=this[`fileList${e.name}`][i];this[`fileList${e.name}`].splice(i,1,Object.assign(o,{message:"",...a})),i+=1}},uploadFilePromise:e=>(console.log("[uploadFilePromise] url",e),new Promise((t=>{setTimeout((()=>t({url:e,status:"success",message:"上传失败"})),1e3)}))),onOversize(e){console.log("[onOversize] file",e),H.onGTip("文件大小不能超过 500kb")},beforeRead:e=>(console.log("[beforeRead] file",e),"image/jpeg"===e.type||(H.onGTip("请上传 jpg 格式图片"),!1)),asyncBeforeRead:e=>(console.log("[asyncBeforeRead] file",e),new Promise(((t,i)=>{if("image/jpeg"!==e.type)H.onGTip("请上传 jpg 格式图片"),i();else{t(new File(["foo"],"bar.jpg",{type:"image/jpeg"}))}})))}},[["render",function(e,s,a,o,l,n){const c=g("PressUploader"),d=g("demo-block"),u=g("PressImage");return t(),i("div",{class:"demo-wrap"},[r(d,{title:e.t("basicUsage")},{default:h((()=>[r(c,{"file-list":l.fileList1,name:"1",multiple:"","max-count":10,onAfterRead:n.afterRead,onDelete:n.deletePic},null,8,["file-list","onAfterRead","onDelete"])])),_:1},8,["title"]),r(d,{title:e.t("uploadVideo")},{default:h((()=>[r(c,{"file-list":l.fileList2,name:"2",multiple:"","max-count":10,accept:"video",onAfterRead:n.afterRead,onDelete:n.deletePic},null,8,["file-list","onAfterRead","onDelete"])])),_:1},8,["title"]),r(d,{title:e.t("uploadStatus")},{default:h((()=>[r(c,{"file-list":l.fileListStatus,name:"Status",multiple:"","max-count":10,accept:"video",onAfterRead:n.afterRead,onDelete:n.deletePic},null,8,["file-list","onAfterRead","onDelete"])])),_:1},8,["title"]),r(d,{title:e.t("preview")},{default:h((()=>[r(c,{"file-list":l.fileList3,name:"3",multiple:"","max-count":10,"preview-full-image":!0,onAfterRead:n.afterRead,onDelete:n.deletePic},null,8,["file-list","onAfterRead","onDelete"])])),_:1},8,["title"]),r(d,{title:e.t("maxCount")},{default:h((()=>[r(c,{"file-list":l.fileList4,name:"4",multiple:"","max-count":2,onAfterRead:n.afterRead,onDelete:n.deletePic},null,8,["file-list","onAfterRead","onDelete"])])),_:1},8,["title"]),r(d,{title:e.t("maxSize")},{default:h((()=>[r(c,{"file-list":l.fileListMaxSize,name:"MaxSize",multiple:"","max-size":512e3,onAfterRead:n.afterRead,onOversize:n.onOversize},null,8,["file-list","onAfterRead","onOversize"])])),_:1},8,["title"]),r(d,{title:e.t("customStyle")},{default:h((()=>[r(c,{"file-list":l.fileList6,name:"6",multiple:"","max-count":1,width:"250",height:"150",onAfterRead:n.afterRead,onDelete:n.deletePic},{default:h((()=>[r(u,{src:"https://mike-1255355338.cos.ap-guangzhou.myqcloud.com/article/2023/10/own_mike_799718017ac81b11c0.png",mode:"widthFix",style:{width:"250px",height:"150px"},width:"250px",height:"150px"})])),_:1},8,["file-list","onAfterRead","onDelete"])])),_:1},8,["title"]),r(d,{title:e.t("beforeRead")},{default:h((()=>[r(c,{"before-read":n.beforeRead},null,8,["before-read"])])),_:1},8,["title"]),r(d,{title:e.t("disabled")},{default:h((()=>[r(c,{disabled:""})])),_:1},8,["title"])])}]]);export{K as default};
