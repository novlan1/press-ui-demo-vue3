import{_ as t,o as e,c as i,i as o,j as s,f as r,V as a,W as n,T as d,q as h,w as l,F as g,r as u,h as c,x as m,e as p,z as y}from"./index-bbcb8c26.js";import{a as f}from"./add-unit.f0f246b9.js";import{s as w}from"./style.0f94ff97.js";import{i as b}from"./utils.3291d63f.js";import{P as _}from"./press-icon-plus.f9955b20.js";import{P as k}from"./press-transition.7dfbabee.js";import{s as S}from"./adapter.23c657c0.js";const v={props:{src:{type:String,default:""},mode:{type:String,default:"scaleToFill"},width:{type:[String,Number],default:300},height:{type:[String,Number],default:225},round:{type:Boolean,default:!1},radius:{type:[String,Number],default:0},lazyLoad:{type:Boolean,default:!0},showMenuByLongpress:{type:Boolean,default:!0},loadingIcon:{type:String,default:"photo"},errorIcon:{type:String,default:"photo-fail"},showLoading:{type:Boolean,default:!0},showError:{type:Boolean,default:!0},fade:{type:Boolean,default:!0},webp:{type:Boolean,default:!1},duration:{type:[String,Number],default:500},backgroundColor:{type:String,default:"#f3f4f6"},customStyle:{type:String,default:""},transitionStyle:{type:String,default:""}}};b()&&S(["uni-image"],app);function x(t){return"Google Inc."===navigator.vendor&&t>10&&(t=2*Math.round(t/2)),t}const I=t({name:"PressImage",options:{virtualHost:!0,styleIsolation:"shared"},components:{PressIconPlus:_,PressTransition:k,InnerImage:t({name:"Image",props:{src:{type:String,default:""},mode:{type:String,default:"scaleToFill"},lazyLoad:{type:[Boolean,String],default:!1},draggable:{type:Boolean,default:!1}},data:()=>({originalWidth:0,originalHeight:0,originalStyle:{width:"",height:""},contentPath:""}),computed:{isVue2(){let t=!0;return t=!1,false},ratio(){return this.originalWidth&&this.originalHeight?this.originalWidth/this.originalHeight:0},style(){let t="auto",e="";switch(this.mode){case"aspectFit":t="contain",e="center center";break;case"aspectFill":t="cover",e="center center";break;case"widthFix":case"heightFix":t="100% 100%";break;case"top":e="center top";break;case"bottom":e="center bottom";break;case"center":e="center center";break;case"left":e="left center";break;case"right":e="right center";break;case"top left":e="left top";break;case"top right":e="right top";break;case"bottom left":e="left bottom";break;case"bottom right":e="right bottom";break;default:t="100% 100%",e="0% 0%"}return{"background-image":this.contentPath?`url("${this.contentPath}")`:"none","background-position":e,"background-size":t,"background-repeat":"no-repeat"}}},watch:{src(){this._loadImage()},mode(t,e){"widthFix"!==e&&"heightFix"!==e||this._resetSize(),"widthFix"!==t&&"heightFix"!==t||this._fixSize()},contentPath(t){!t&&this.__img&&(this.__img.remove(),delete this.__img)}},mounted(){this.originalStyle.width=this.$el.style.width||"",this.originalStyle.height=this.$el.style.height||"",this._loadImage()},beforeDestroy(){this._clearImage()},methods:{_fixSize(){if(this.ratio){const{$el:t}=this;if("widthFix"===this.mode){const e=t.offsetWidth;e&&(t.style.height=`${x(e/this.ratio)}px`)}else if("heightFix"===this.mode){const e=t.offsetHeight;e&&(t.style.width=`${x(e*this.ratio)}px`)}}window.dispatchEvent(new CustomEvent("updateview"))},_resetSize(){this.$el.style.width=this.originalStyle.width,this.$el.style.height=this.originalStyle.height},_resetData(){this.originalWidth=0,this.originalHeight=0,this.contentPath=""},_loadImage(){const t=this.src;if(t){this._img=this._img||new Image;const e=this._img;e.onload=i=>{this._img=null,this.originalWidth=e.width;const o=this.originalWidth;this.originalHeight=e.height;const s=this.originalHeight;this._fixSize(),this.contentPath=t,e.draggable=this.draggable,this.__img&&this.__img.remove(),this.__img=e,this.$el.appendChild(e),this.$emit("load",i,{width:o,height:s})},e.onerror=t=>{this._img=null,this._resetData(),this.$emit("error",t,{errMsg:`GET ${this.src} 404 (Not Found)`})},e.src=t}else this._clearImage(),this._resetData()},_clearImage(){const t=this._img;t&&(t.onload=null,t.onerror=null,this._img=null)}}},[["render",function(t,h,l,g,u,c){return c.isVue2?(e(),i("uni-image",a({key:0},n(t.$listeners,!0)),[o("div",{ref:"content",style:s(c.style)},null,4),"widthFix"===l.mode||"heightFix"===l.mode?(e(),i("div",{key:0,ref:"sensor",onResize:h[0]||(h[0]=t=>c._fixSize())},null,544)):r("v-if",!0)],16)):(e(),i("uni-image",d(a({key:1},t.$attrs)),[o("div",{ref:"content",style:s(c.style)},null,4),"widthFix"===l.mode||"heightFix"===l.mode?(e(),i("div",{key:0,ref:"sensor",onResize:h[1]||(h[1]=t=>c._fixSize())},null,544)):r("v-if",!0)],16))}],["__scopeId","data-v-f03f6862"]])},mixins:[v],emits:["click","error","load"],data(){return{isError:!1,loading:!0,opacity:1,durationTime:this.duration,backgroundStyle:{},show:!1,isNotInUni:b()}},computed:{wrapStyle(){const t={};t.width=f(this.width),t.height=f(this.height),t.borderRadius=this.round?"10000px":f(this.radius),t.overflow=this.radius>0?"hidden":"visible";return w([{...t,...this.backgroundStyle},this.customStyle])}},watch:{src:{immediate:!0,handler(t){t?(this.isError=!1,this.loading=!0):this.isError=!0}}},mounted(){this.show=!0},methods:{addUnit:f,onClick(){this.$emit("click")},onErrorHandler(t){this.loading=!1,this.isError=!0,this.$emit("error",t)},onLoadHandler(t){this.loading=!1,this.isError=!1,this.$emit("load",t),this.removeBgColor()},removeBgColor(){this.backgroundStyle={backgroundColor:"transparent"}}}},[["render",function(t,a,n,d,f,w){const b=p("InnerImage"),_=y,k=p("PressIconPlus"),S=p("PressTransition");return e(),h(S,{mode:"fade",show:f.show,duration:t.fade?f.durationTime:0,"custom-style":`display: inline-block;${t.transitionStyle}`},{default:l((()=>[o("div",{class:"press-image",style:s(w.wrapStyle),onClick:a[0]||(a[0]=m(((...t)=>w.onClick&&w.onClick(...t)),["stop"]))},[f.isError?r("v-if",!0):(e(),i(g,{key:0},[f.isNotInUni?(e(),h(b,{key:0,src:t.src,mode:t.mode,"show-menu-by-longpress":t.showMenuByLongpress,"lazy-load":t.lazyLoad,class:"press-image__image",style:s({borderRadius:t.round?"10000px":w.addUnit(t.radius),width:w.addUnit(t.width),height:w.addUnit(t.height)}),onError:w.onErrorHandler,onLoad:w.onLoadHandler},null,8,["src","mode","show-menu-by-longpress","lazy-load","style","onError","onLoad"])):r("v-if",!0),f.isNotInUni?r("v-if",!0):(e(),h(_,{key:1,src:t.src,mode:t.mode,"show-menu-by-longpress":t.showMenuByLongpress,"lazy-load":t.lazyLoad,class:"press-image__image",style:s({borderRadius:t.round?"10000px":w.addUnit(t.radius),width:w.addUnit(t.width),height:w.addUnit(t.height)}),onError:w.onErrorHandler,onLoad:w.onLoadHandler},null,8,["src","mode","show-menu-by-longpress","lazy-load","style","onError","onLoad"]))],64)),t.showLoading&&f.loading?(e(),i("div",{key:1,class:"press-image__loading",style:s({borderRadius:t.round?"50%":w.addUnit(t.radius),backgroundColor:t.backgroundColor,width:w.addUnit(t.width),height:w.addUnit(t.height)})},[u(t.$slots,"loading",{},(()=>[c(k,{name:t.loadingIcon,width:t.width,height:t.height},null,8,["name","width","height"])]),!0)],4)):r("v-if",!0),t.showError&&f.isError&&!f.loading?(e(),i("div",{key:2,class:"press-image__error",style:s({borderRadius:t.round?"50%":w.addUnit(t.radius),width:w.addUnit(t.width),height:w.addUnit(t.height)})},[u(t.$slots,"error",{},(()=>[c(k,{name:t.errorIcon,width:t.width,height:t.height},null,8,["name","width","height"])]),!0)],4)):r("v-if",!0)],4)])),_:3},8,["show","duration","custom-style"])}],["__scopeId","data-v-1bede914"]]);export{I as P};
