import{_ as e,l as t,z as s,a5 as r,a6 as a,aP as i,o as l,c as o,a as n,i as c,b as d,r as u,F as h,t as v,f as p,j as y,h as m,b2 as C,b3 as f,P as x,e as g}from"./index-5bc1d01b.js";import{W as k,B as w}from"./color.3a05f6e0.js";import{a as S}from"./canvas.25858f9a.js";let I=0;const _=2*Math.PI,P=-Math.PI/2;const V=e({i18n:{"zh-CN":{gradient:"渐变色",customSize:"大小定制",customStyle:"样式定制",customColor:"颜色定制",customWidth:"宽度定制",counterClockwise:"逆时针"},"en-US":{gradient:"Gradient",customSize:"Size",customStyle:"Custom Style",customColor:"Color",customWidth:"Width",counterClockwise:"Direction"}},components:{PressCircle:e({name:"PressCircle",props:{text:{type:String,default:""},lineCap:{type:String,default:"round"},value:{type:Number,default:0},speed:{type:Number,default:50},size:{type:Number,default:100},fill:{type:String,default:""},layerColor:{type:String,default:k},color:{type:null,default:w},type:{type:String,default:""},strokeWidth:{type:Number,default:4},clockwise:{type:Boolean,default:!0}},emits:[],data:()=>({hoverColor:w,id:1,isNotInUni:t()}),computed:{circleStyle(){const{size:e}=this;return`width: ${s.addUnit(e)};height: ${s.addUnit(e)}`},canvasId(){return`press-circle-${this.id}`}},watch:{value:{handler(){this.reRender()}},size:{handler(){this.drawCircle(this.currentValue)}},color:{handler(){this.setHoverColor().then((()=>{this.drawCircle(this.currentValue)}))}}},created(){I+=1,this.id=I},mounted(){this.currentValue=this.value,this.setHoverColor().then((()=>{this.drawCircle(this.currentValue)}))},destroyed(){this.onDestroyed()},unmounted(){this.onDestroyed()},methods:{onDestroyed(){this.clearMockInterval()},getContext(){const{type:e,size:s}=this;if(t()){const e=window.devicePixelRatio,t=document.getElementById(this.canvasId),r=t.getContext("2d");return this.inited||(this.inited=!0,t.width=s*e,t.height=s*e,r.scale(e,e)),Promise.resolve(S(r))}if(""===e||!r()){const e=uni.createCanvasContext(this.canvasId,this);return Promise.resolve(e)}const i=a().pixelRatio;return new Promise((t=>{uni.createSelectorQuery().in(this).select(`#${this.canvasId}`).node().exec((r=>{const a=r[0].node,l=a.getContext(e);this.inited||(this.inited=!0,a.width=s*i,a.height=s*i,l.scale(i,i)),t(S(l))}))}))},setHoverColor(){const{color:e,size:t}=this;return i(e)?this.getContext().then((s=>{const r=s.createLinearGradient(t,0,0,0);Object.keys(e).sort(((e,t)=>parseFloat(e)-parseFloat(t))).map((t=>r.addColorStop(parseFloat(t)/100,e[t]))),this.hoverColor=r})):(this.hoverColor=e,Promise.resolve())},presetCanvas(e,t,s,r,a){const{strokeWidth:i,lineCap:l,clockwise:o,size:n}=this,c=n/2,d=c-i/2;e.setStrokeStyle(t),e.setLineWidth(i),e.setLineCap(l),e.beginPath(),e.arc(c,c,d,s,r,!o),e.stroke(),a&&(e.setFillStyle(a),e.fill())},renderLayerCircle(e){const{layerColor:t,fill:s}=this;this.presetCanvas(e,t,0,_,s)},renderHoverCircle(e,t){const{clockwise:s}=this,r=_*(t/100),a=s?P+r:3*Math.PI-(P+r);this.presetCanvas(e,this.hoverColor,P,a)},drawCircle(e){const{size:t}=this;this.getContext().then((s=>{s.clearRect(0,0,t,t),this.renderLayerCircle(s);const r=(a=e,Math.min(Math.max(a,0),100));var a;0!==r&&this.renderHoverCircle(s,r),s.draw()}))},reRender(){const{value:e,speed:t}=this;if(t<=0||t>1e3)return void this.drawCircle(e);this.clearMockInterval(),this.currentValue=this.currentValue||0;const s=()=>{this.interval=setTimeout((()=>{this.currentValue!==e?(Math.abs(this.currentValue-e)<1?this.currentValue=e:this.currentValue<e?this.currentValue+=1:this.currentValue-=1,this.drawCircle(this.currentValue),s()):this.clearMockInterval()}),1e3/t)};s()},clearMockInterval(){this.interval&&(clearTimeout(this.interval),this.interval=null)}}},[["render",function(e,t,s,r,a,i){const x=C,g=f;return l(),o("div",{class:"press-circle-index"},[n("div",{class:"press-circle"},[c(x,{id:i.canvasId,class:"press-circle__canvas",type:s.type,style:d(i.circleStyle),"canvas-id":i.canvasId},null,8,["id","type","style","canvas-id"]),s.text?(l(),o(h,{key:1},[a.isNotInUni?(l(),o("div",{key:0,class:"press-circle__text"},v(s.text),1)):(l(),p(g,{key:1,class:"press-circle__text"},{default:y((()=>[m(v(s.text),1)])),_:1}))],64)):(l(),o("div",{key:0,class:"press-circle__text"},[u(e.$slots,"default",{},void 0,!0)]))])])}],["__scopeId","data-v-5e07ddd4"]]),PressButton:x},data:()=>({value:20,headerStyle:"background: #f7f8fa;",sectionStyle:"background: #f7f8fa;margin: 0;padding: 0 12px;",gradientColor:{"0%":"#3fecff","100%":"#6149f6"}}),methods:{onChangeCircleValue(e){if("plus"===e){if(this.value>=100)return;this.value+=20}else if("minus"===e){if(this.value<=0)return;this.value-=20}}}},[["render",function(e,t,s,r,a,i){const d=g("PressCircle"),u=g("demo-block"),h=g("PressButton");return l(),o("div",{class:"demo-wrap demo-wrap--gray"},[c(u,{title:e.t("basicUsage"),"header-style":a.headerStyle,"section-style":a.sectionStyle},{default:y((()=>[c(d,{value:a.value,text:`${a.value}%`},null,8,["value","text"])])),_:1},8,["title","header-style","section-style"]),c(u,{title:e.t("customStyle"),"header-style":a.headerStyle,"section-style":a.sectionStyle},{default:y((()=>[n("div",{class:"demo-part"},[c(d,{value:a.value,"stroke-width":6,text:e.t("customWidth")},null,8,["value","text"])]),n("div",{class:"demo-part"},[c(d,{value:a.value,"stroke-width":6,"layer-color":"#eeeeee",color:"#ee0a24",text:e.t("customColor")},null,8,["value","text"])]),n("div",{class:"demo-part"},[c(d,{value:a.value,"stroke-width":6,color:a.gradientColor,text:e.t("gradient")},null,8,["value","color","text"])]),n("div",{class:"demo-part"},[c(d,{value:a.value,"stroke-width":6,color:"#07c160",clockwise:!1,text:e.t("counterClockwise")},null,8,["value","text"])]),n("div",{class:"demo-part"},[c(d,{value:a.value,size:120,text:e.t("customSize")},null,8,["value","text"])]),n("div",null,[c(h,{type:"e-sport-primary","custom-style":"margin-right:8px;",onClick:t[0]||(t[0]=e=>i.onChangeCircleValue("plus"))},{default:y((()=>[m(v(e.t("add")),1)])),_:1}),c(h,{type:"e-sport-primary",onClick:t[1]||(t[1]=e=>i.onChangeCircleValue("minus"))},{default:y((()=>[m(v(e.t("decrease")),1)])),_:1})])])),_:1},8,["title","header-style","section-style"])])}],["__scopeId","data-v-173fed69"]]);export{V as default};
