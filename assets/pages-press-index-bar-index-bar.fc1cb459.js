import{x as t,y as e,O as s,_ as o,o as n,c as r,f as i,n as l,a,e as c,t as h,A as d,W as p,N as u,b4 as x,i as f,j as m,w as y,F as S,k as g,b as v,S as T,p as b,r as I}from"./index-d9d977eb.js";import{h as k}from"./parent-map.7daf54ee.js";import{C as A,P as C}from"./relation.8b10893c.js";import{a as w}from"./color.3a05f6e0.js";import{S as D}from"./scroll-view.db72462b.js";const _=o({name:"PressIndexAnchor",options:{...t,styleIsolation:"shared"},mixins:[A(k,{indexKey:"tIndex"})],props:{useSlot:Boolean,index:{type:[Number,String],default:""},...e},emits:[],data:()=>({active:!1,wrapperStyle:"",anchorStyle:""}),methods:{setData(t){Object.keys(t).forEach((e=>{this[e]=t[e]}))},scrollIntoView(t,e){s(this,".press-index-anchor-wrapper").then((s=>{const o=t+s.top;null==e||e(o)}))}}},[["render",function(t,e,s,o,d,p){return n(),r("div",null,[i("div",{class:"press-index-anchor-wrapper",style:a(d.wrapperStyle)},[i("div",{class:l("press-index-anchor "+(d.active?"press-index-anchor--active press-hairline--bottom":"")),style:a(d.anchorStyle)},[s.useSlot?c(t.$slots,"default",{key:0},void 0,!0):(n(),r("span",{key:1},h(s.index),1))],6)],4)])}],["__scopeId","data-v-d058cb23"]]);const j=o({name:"PressIndexBar",options:{...t,styleIsolation:"shared"},mixins:[C(k),D],props:{sticky:{type:Boolean,default:!0},zIndex:{type:Number,default:1},highlightColor:{type:String,default:w},stickyOffsetTop:{type:Number,default:0},indexList:{type:Array,default:()=>(()=>{const t=[],e="A".charCodeAt(0);for(let s=0;s<26;s++)t.push(String.fromCharCode(e+s));return t})()},...e},emits:["select"],data:()=>({activeAnchorIndex:null,showSidebar:!1,sidebar:{},curScrollTop:0}),created(){this.scrollTop=0,this.children=[]},mounted(){this.updateData()},methods:{setData(t){Object.keys(t).forEach((e=>{this[e]=t[e]}))},updateData(){d((()=>{null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.showSidebar=!!this.children.length,d((()=>{this.setRect().then((()=>{this.onScroll()}))}))}),0)}))},setRect(){return Promise.all([this.setAnchorsRect(),this.setListRect(),this.setSiderbarRect()])},setAnchorsRect(){return Promise.all(this.children.map((t=>s(t,".press-index-anchor-wrapper").then((e=>(Object.assign(t,{height:e.height,top:e.top+this.scrollTop}),t))))))},setListRect(){return s(this,".press-index-bar").then((t=>{p(t)&&Object.assign(this,{height:t.height,top:t.top+this.scrollTop})}))},setSiderbarRect(){return s(this,".press-index-bar__sidebar").then((t=>{p(t)&&(this.sidebar={height:t.height,top:t.top})}))},setDiffData({target:t,data:e}){const s={};Object.keys(e).forEach((o=>{t[o]!==e[o]&&(s[o]=e[o])})),Object.keys(s).length&&t.setData(s)},getAnchorRect:t=>s(t,".press-index-anchor-wrapper").then((t=>({height:t.height,top:t.top}))),getActiveAnchorIndex(){const{children:t,scrollTop:e}=this,{sticky:s}=this;for(let o=this.children.length-1;o>=0;o--){const n=o>0?t[o-1].height:0;if((s?n:0)+e>=t[o].top)return o}return-1},onScroll(t){var e,s;t&&(t.target||t.detail)&&(this.scrollTop=(null==(e=t.target)?void 0:e.scrollTop)||(null==(s=t.detail)?void 0:s.scrollTop)||0);const{children:o=[],scrollTop:n}=this;if(!o.length)return;const{sticky:r,stickyOffsetTop:i,zIndex:l,highlightColor:a}=this,c=this.getActiveAnchorIndex();if(this.setDiffData({target:this,data:{activeAnchorIndex:c}}),r){let t=!1;-1!==c&&(t=o[c].top<=+n),o.forEach(((e,s)=>{if(s===c){let n="",r=`\n              color: ${a};\n            `;t&&(n=`\n                height: ${o[s].height}px;\n              `,r=`\n                position: fixed;\n                top: ${i}px;\n                z-index: ${l};\n                color: ${a};\n              `),this.setDiffData({target:e,data:{active:!0,anchorStyle:r,wrapperStyle:n}})}else if(s===c-1){const t=o[s],n=t.top,r=`\n              position: relative;\n              transform: translate3d(0, ${(s===o.length-1?this.top:o[s+1].top)-n-t.height}px, 0);\n              z-index: ${l};\n              color: ${a};\n            `;this.setDiffData({target:e,data:{active:!0,anchorStyle:r}})}else this.setDiffData({target:e,data:{active:!1,anchorStyle:"",wrapperStyle:""}})}))}},onClick(){},onTouchMove(t){const e=this.children.length,s=t.touches[0],o=this.sidebar.height/e;let n;n=Math.floor((u(s.clientY)-this.sidebar.top)/o),n<0?n=0:n>e-1&&(n=e-1),this.scrollToAnchor(n)},onTouchStop(){this.scrollToAnchorIndex=null},scrollToAnchor(t){if("number"!=typeof t||this.scrollToAnchorIndex===t)return;this.scrollToAnchorIndex=t;const e=this.children.find((e=>e.index===this.indexList[t]));void 0!==e&&(e.scrollIntoView(this.scrollTop,this.changeScrollerTop),this.$emit("select",e.index))},onClickInner(t){var e,s;const o=null==(s=null==(e=t.currentTarget)?void 0:e.dataset)?void 0:s.index;void 0!==o&&this.scrollToAnchor(+o)},onWatchScroll(t){this.onScroll(t)},changeScrollerTop(t){const e=x("pressIndexBarWrapper"),s=null==document?void 0:document.querySelector(e);s&&(s.scrollTop=t)}}},[["render",function(t,e,s,o,l,d){const p=T;return n(),r("div",{class:"press-index-bar-container"},[f(p,{id:"pressIndexBarWrapper",class:"press-index-bar-wrapper",enhanced:"","scroll-with-animation":!1,"scroll-y":"","scroll-top":l.curScrollTop,onScroll:d.onWatchScroll},{default:m((()=>[i("div",{class:"press-index-bar"},[c(t.$slots,"default",{},void 0,!0)])])),_:3},8,["scroll-top","onScroll"]),l.showSidebar?(n(),r("div",{key:0,class:"press-index-bar__sidebar",onClick:e[1]||(e[1]=y(((...t)=>d.onClick&&d.onClick(...t)),["stop","prevent"])),onTouchmove:e[2]||(e[2]=y(((...t)=>d.onTouchMove&&d.onTouchMove(...t)),["stop","prevent"])),onTouchend:e[3]||(e[3]=y(((...t)=>d.onTouchStop&&d.onTouchStop(...t)),["stop"])),onTouchcancel:e[4]||(e[4]=y(((...t)=>d.onTouchStop&&d.onTouchStop(...t)),["stop","prevent"]))},[(n(!0),r(S,null,g(s.indexList,((t,o)=>(n(),r("div",{key:o,class:"press-index-bar__index",style:a("z-index: "+(s.zIndex+1)+"; color: "+(l.activeAnchorIndex===o?s.highlightColor:"")),"data-index":o,onClick:e[0]||(e[0]=y(((...t)=>d.onClickInner&&d.onClickInner(...t)),["stop"]))},h(t),13,["data-index"])))),128))],32)):v("v-if",!0)])}],["__scopeId","data-v-c421b9d3"]]);const O=function(){const t=[];for(let e=65;e<91;e++)t.push(String.fromCharCode(e));return t}();const P=o({i18n:{"zh-CN":{text:"文本",customIndexList:"自定义索引列表"},"en-US":{text:"Text",customIndexList:"Custom Index List"}},components:{PressCell:b,PressIndexBar:j,PressIndexAnchor:_},data(){let t=0;return t=44,{anchorList:O,wrapStyle:"",stickyOffsetTop:44}},mounted(){},methods:{onSelect(t){console.log("[onSelect]: ",t)}}},[["render",function(t,e,s,o,i,l){const c=I("PressIndexAnchor"),h=I("PressCell"),d=I("PressIndexBar");return n(),r("div",{class:"demo-wrap",style:a(i.wrapStyle)},[f(d,{"sticky-offset-top":i.stickyOffsetTop,onSelect:l.onSelect},{default:m((()=>[(n(!0),r(S,null,g(i.anchorList,((e,s)=>(n(),r("div",{key:s},[f(c,{index:e},null,8,["index"]),f(h,{title:t.t("text")},null,8,["title"]),f(h,{title:t.t("text")},null,8,["title"]),f(h,{title:t.t("text")},null,8,["title"])])))),128))])),_:1},8,["sticky-offset-top","onSelect"])],4)}]]);export{P as default};
