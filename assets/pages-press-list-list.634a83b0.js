import{_ as e,o as t,q as l,w as i,i as s,r as o,j as a,h as r,v as n,t as c,f as h,n as d,e as u,S as p,ai as m,aj as g,Q as f,ak as y,c as S,F as v,p as k}from"./index-64b5aeb5.js";import{d as L,a as C}from"./press-component.6d1ba0d0.js";import{P}from"./press-loading-plus.b0c8e882.js";import{f as b,b as x,d as _}from"./rect.8c325831.js";import{v as w,n as I}from"./add-unit.62ceb573.js";import{B as D}from"./bind-event.7ef0af23.js";import{S as j}from"./scroll-view.59c60677.js";import{P as T}from"./press-popup-cell.8cb03a87.js";import{P as A}from"./press-picker.56e0f3a3.js";import{P as V}from"./press-cell.c05d76c5.js";import"./utils.28df66fa.js";import"./style.0f94ff97.js";import"./version.e043cae6.js";import"./event.c5c037f6.js";import"./support-passive.bc409298.js";import"./press-popup.ef3ccc91.js";import"./press-button.f0ed107b.js";import"./press-icon-plus.d8bee82b.js";import"./press-info.07976493.js";import"./press-loading.66199465.js";import"./button.0566dd7b.js";import"./function.8cc69bc2.js";import"./press-switch.2a6a3c9f.js";import"./computed.0bc97806.js";import"./functional.e682c3f2.js";import"./index.8f00792c.js";import"./link.ac19c55e.js";const z="scrollViewId",B=b(z);const M=e({name:"PressList",options:{...L},components:{PressLoadingPlus:P},mixins:[w,D((function(e){this.autoCheckScroller&&(this.scroller||(this.scroller=_(this.$el)),e(this.scroller,"scroll",this.onScroll,!0),e(this.scroller,"touchmove",this.onScroll,!0),this.onScroll())})),j],props:{offset:{type:[Number,String],default:50},finished:{type:Boolean,default:!1},finishedText:{type:String,default:""},loadingText:{type:String,default:"加载中..."},immediateCheck:{type:Boolean,default:!0},enableFlex:{type:Boolean,default:!1},enhanced:{type:Boolean,default:!1},scrollWithAnimation:{type:Boolean,default:!1},enablePassive:{type:Boolean,default:!1},scrollAnchoring:{type:Boolean,default:!1},scrollToElementById:{type:String,default:""},vertical:{type:Boolean,default:!0},loadingStyle:{type:String,default:""},loadingSize:{type:String,default:"20px"},finishedStyle:{type:String,default:""},autoCheckScroller:{type:Boolean,default:!1},scrollLeft:{type:[Number,String],default:0},scrollTop:{type:[Number,String],default:0},...C,customStyle:{type:String,default:""}},emits:["scroll","input","load","update:modelValue"],data(){return{innerLoading:this.realModelValue,SCROLL_VIEW_ID:z,scrollerHeight:0}},computed:{scrollViewClass(){return["press-list",this.vertical?"press-list--vertical":"press-list--hor",this.customClass].join(" ")},scrollViewStyle(){return`height: 100%; ${this.customStyle};`}},watch:{realModelValue:{handler(e){this.innerLoading=e,this.check()}},finished:"check"},mounted(){this.immediateCheck&&this.check()},updated(){},methods:{getScrollerHeight(){this.scrollerHeight||x(this,B).then((e=>{this.scrollerHeight=e.height}))},scroll(e){this.getScrollerHeight(),this.$emit("scroll",e,this.scrollerHeight),this.check()},scrollToLower(){this.emitInput()},emitInput(){this.innerLoading||this.finished||(this.innerLoading=!0,this.emitModelValue(!0),this.$emit("load"))},check(){I((()=>{this.innerCheck()}))},innerCheck(){this.autoCheckScroller||this.commonCheck()},commonCheck(e){const{offset:t}=this;this.innerLoading||this.finished||Promise.all([x(this,".press-list__placeholder"),x(this,B)]).then((l=>{const{0:i,1:s}=l;if(void 0===e&&(e=s),this.innerLoading||this.finished)return;if(!(e.bottom-e.top))return;let o=i.bottom-e.bottom;this.vertical||(o=i.right-e.right);o<=t&&this.emitInput()})).catch((()=>{})).finally((()=>{}))},onScroll(){const{scroller:e,autoCheckScroller:t}=this;if(!t)return;let l;(null==e?void 0:e.getBoundingClientRect)&&(l=e.getBoundingClientRect()),this.commonCheck(l)}}},[["render",function(e,m,g,f,y,S){const v=u("PressLoadingPlus"),k=p;return t(),l(k,{id:y.SCROLL_VIEW_ID,style:a(S.scrollViewStyle),"scroll-y":g.vertical,"scroll-x":!g.vertical,"scroll-with-animation":g.scrollWithAnimation,"scroll-anchoring":g.scrollAnchoring,enhanced:g.enhanced,"enable-flex":g.enableFlex,"enable-passive":g.enablePassive,"lower-threshold":g.offset,"scroll-into-view":g.scrollToElementById,class:d(S.scrollViewClass),"scroll-top":g.scrollTop,"scroll-left":g.scrollLeft,onScrolltolower:S.scrollToLower,onScroll:S.scroll},{default:i((()=>[s("div",{class:"press-list__layout"},[o(e.$slots,"default",{},void 0,!0),y.innerLoading?o(e.$slots,"loading",{key:0},(()=>[s("div",{class:"press-list__loading",style:a(g.loadingStyle)},[r(v,{vertical:!g.vertical,size:g.loadingSize},{default:i((()=>[n(c(g.loadingText),1)])),_:1},8,["vertical","size"])],4)]),!0):h("v-if",!0),g.finishedText&&g.finished?o(e.$slots,"finished",{key:1},(()=>[s("div",{class:"press-list__finished",style:a(g.finishedStyle)},[s("div",null,c(g.finishedText),1)],4)]),!0):h("v-if",!0),s("div",{class:"press-list__placeholder"})])])),_:3},8,["id","style","scroll-y","scroll-x","scroll-with-animation","scroll-anchoring","enhanced","enable-flex","enable-passive","lower-threshold","scroll-into-view","class","scroll-top","scroll-left","onScrolltolower","onScroll"])}],["__scopeId","data-v-bcb1e529"]]),N={pageSize:20,total:300,delay:200,vertical:!0,autoCheckScroller:!0},U=Array.from({length:5}).map(((e,t)=>10**t)).reduce(((e,t)=>{for(let l=1;l<10;l++)e.push(t*l);return e}),[]).map((e=>({label:e,value:e}))),F=U.reduce(((e,t)=>(e[t.value]=t.label,e)),{}),$=Array.from({length:1e3}).map(((e,t)=>({label:100*(t+1)+"ms",value:100*(t+1)}))),O=$.reduce(((e,t)=>(e[t.value]=t.label,e)),{});const E=e({i18n:{"zh-CN":{custom:"自定义"},"en-US":{custom:"Custom"}},components:{PressList:M,PressPopupCell:T,PressPicker:A,PressCell:V},mixins:[((e=500)=>({data:()=>({currentIndex:0,useVirtualList:!0}),computed:{upMissed(){const{currentIndex:t}=this;return Math.max(0,t-e)},showingData(){const{currentIndex:t,upMissed:l,list:i,useVirtualList:s}=this;return s?i.slice(l,t+e).map(((e,t)=>({...e,uniqueKey:t+l}))):i},hiddenUpPartStyle(){const{upMissed:e,useVirtualList:t}=this;if(!t)return"";return`height: ${50*e}px;`},wrapStyle(){const{list:e,useVirtualList:t}=this;return t?`height: ${50*e.length}px;`:""}},methods:{updateCurrentIndex(e,t){const{scrollTop:l,scrollHeight:i}=f(e);if(l<0)return;if(t+l>i)return;const s=Math.round(l/50);this.currentIndex=s}}}))()],data(){const e={...N};return{sectionStyle:"margin: 0;background: #f7f8fa;",headerStyle:"background: #f7f8fa;",loading:!1,finished:!1,immediateCheck:!0,list:[],FUNCTIONAL_ID_MAP:y,listLocal:e,listStyle:""}},computed:{},watch:{listLocal:{handler(e){e.vertical||(this.useVirtualList=!1)},deep:!0}},mounted(){},methods:{load(){console.log("[load]"),this.onFetchData()},scroll(e,t){this.updateCurrentIndex(e,t)},onFetchData(e){var t;const{total:l,pageSize:i,delay:s}=this.listLocal;(function({length:e,delay:t,beforeLength:l}){return new Promise((i=>{setTimeout((()=>{i({data:Array.from({length:e}).map(((e,t)=>{let i=t+l+1;return i<10&&(i=`0${i}`),{label:i,value:i}}))})}),t||0)}))})({delay:s,length:i,beforeLength:e?0:(null==(t=this.list)?void 0:t.length)||0}).then((({data:t})=>{let i=e?t:[...this.list,...t];i.length>l&&(i=i.slice(0,l)),this.list=i,console.log("[current total]",i.length),this.loading=!1,this.finished=this.list.length>=l})).catch((()=>{}))},onShowBasicPopupCell(){!function({context:e,callback:t}){m({context:e,title:"自定义设置",closeIcon:!0,cellList:[{label:"每次加载数量",value:F[N.pageSize],click:({context:l})=>{l.closeDialog(),g({title:"每次加载数量",closeIcon:!0,list:U,current:{value:N.pageSize},context:e}).then((({item:l})=>{N.pageSize=l.value,e.onGTip("设置成功"),"function"==typeof t.changePageSize&&t.changePageSize.call(e,l.value)})).catch((()=>{}))}},{label:"列表总数",value:F[N.total],click:({context:l})=>{l.closeDialog(),g({title:"列表总数",closeIcon:!0,list:U,current:{value:N.total},context:e}).then((({item:l})=>{N.total=l.value,e.onGTip("设置成功"),"function"==typeof t.changeTotal&&t.changeTotal.call(e,l.value)})).catch((()=>{}))}},{label:"数据请求时间",value:O[N.delay],click:({context:l})=>{l.closeDialog(),g({title:"数据请求时间",closeIcon:!0,list:$,current:{value:N.delay},context:e}).then((({item:l})=>{N.delay=l.value,e.onGTip("设置成功"),"function"==typeof t.changeDelay&&t.changeDelay.call(e,l.value)})).catch((()=>{}))}},{label:"是否竖向滚动",type:"switch",open:N.vertical,click:({context:l})=>{l.closeDialog(),N.vertical=!N.vertical,e.onGTip("设置成功"),"function"==typeof t.changeDirection&&t.changeDirection.call(e,N.vertical)}},{label:"自动检测 Scroller",type:"switch",open:N.autoCheckScroller,click:({context:l})=>{l.closeDialog(),N.autoCheckScroller=!N.autoCheckScroller,"function"==typeof t.changeAutoCheckScroller&&t.changeAutoCheckScroller.call(e,N.autoCheckScroller)}}]})}({context:this,callback:{changeTotal:this.changeTotal,changePageSize:this.changePageSize,changeDelay:this.changeDelay,changeDirection:this.changeDirection,changeAutoCheckScroller:this.changeAutoCheckScroller}})},changePageSize(e){this.listLocal={...this.listLocal,pageSize:e},this.generateData()},changeTotal(e){this.listLocal={...this.listLocal,total:e},this.generateData()},changeDelay(e){this.listLocal={...this.listLocal,delay:e},this.generateData()},changeDirection(e){this.listLocal={...this.listLocal,vertical:e},this.generateData()},changeAutoCheckScroller(e){this.listLocal={...this.listLocal,autoCheckScroller:e},this.list=[],this.generateData()},generateData(){this.loading=!0,this.onFetchData(!0)}}},[["render",function(e,l,o,n,h,p){const m=u("press-cell"),g=u("demo-block"),f=u("PressList"),y=u("PressPopupCell"),L=u("PressPicker");return t(),S("div",{class:d(["demo-wrap demo-wrap--gray demo-wrap--flex",h.listLocal.vertical?"":"demo-wrap--hor"])},[r(g,{title:e.t("basicUsage"),"section-style":h.sectionStyle,"header-style":h.headerStyle},{default:i((()=>[r(m,{title:e.t("custom"),"is-link":"",onClick:p.onShowBasicPopupCell},null,8,["title","onClick"])])),_:1},8,["title","section-style","header-style"]),s("div",{class:"demo-container"},[r(f,{modelValue:h.loading,"onUpdate:modelValue":l[0]||(l[0]=e=>h.loading=e),finished:h.finished,"immediate-check":h.immediateCheck,vertical:h.listLocal.vertical,"finished-text":"没有更多了","auto-check-scroller":h.listLocal.autoCheckScroller,"custom-style":h.listStyle,onLoad:p.load,onScroll:p.scroll},{default:i((()=>[s("div",{style:a(e.wrapStyle),class:"list__wrap"},[s("div",{style:a(e.hiddenUpPartStyle)},null,4),(t(!0),S(v,null,k(e.showingData,(e=>(t(),S("div",{key:e.value,class:"list__item"},c(e.label),1)))),128))],4)])),_:1},8,["modelValue","finished","immediate-check","vertical","auto-check-scroller","custom-style","onLoad","onScroll"])]),r(y,{id:h.FUNCTIONAL_ID_MAP.POPUP_CELL,ref:h.FUNCTIONAL_ID_MAP.POPUP_CELL,mode:"functional"},null,8,["id"]),r(L,{id:h.FUNCTIONAL_ID_MAP.PICKER,ref:h.FUNCTIONAL_ID_MAP.PICKER,mode:"functional"},null,8,["id"])],2)}],["__scopeId","data-v-d2486478"]]);export{E as default};
