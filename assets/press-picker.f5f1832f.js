import{P as t}from"./press-popup.92bfabe2.js";import{b as e}from"./rect.6dcbbb2d.js";import{_ as i,o as r,c as n,i as s,f as o,j as a,F as l,p as h,n as u,t as c,x as d,q as p,w as m,h as v,e as f}from"./index-dd603bd1.js";import{t as w}from"./index.2ba3dfc9.js";import{e as y}from"./press-component.fa6a167d.js";import{f as g}from"./functional.e92d84e5.js";function C(t){return t.changedTouches&&t.changedTouches[0]?t.changedTouches[0]:t.touches&&t.touches[0]?t.touches[0]:t}const k={arrowIcon:"showBackArrow",list:"selectList",current:"selectItem",confirm:"onClickConfirm",cancel:"onRemove"};const x=i({name:"PressPicker",options:{styleIsolation:"shared"},components:{PickerInner:i({components:{PressPopup:t,PressPickerView:i({name:"PressPickerView",props:{data:{type:Array,default:()=>[{label:"test"},{label:"test"},{label:"test"},{label:"test"},{label:"test"},{label:"test"}],required:!0},current:{type:Object,default:null,required:!1},hasTip:{type:Boolean,default:!1,required:!1},virtualListThreshold:{type:Number,default:50},horizontal:{type:Boolean,default:!1}},options:{virtualHost:!0},emits:["currentIndexChanged"],data:()=>({currentIndex:0,currentScroll:0,start:0,startScroll:0,move:0,itemHeight:56,downX:0,downY:0,upX:0,upY:0,lastMove:0,lastTime:0,speed:0,hasClick:!1,slideLimitNum:10,slideTimeThreshold:300}),computed:{upMissed(){const{currentIndex:t,virtualListThreshold:e}=this;return Math.max(0,t-e)},hiddenUpPartStyle(){const{itemHeight:t,upMissed:e}=this;return`height: ${e*t}px;`},hiddenBottomPartStyle(){const{currentIndex:t,data:e,itemHeight:i,virtualListThreshold:r}=this;return`height: ${(e.length-t-r)*i}px;`},showingData(){const{currentIndex:t,virtualListThreshold:e,upMissed:i}=this;return this.data.slice(i,t+e).map(((t,e)=>({...t,uniqueKey:e+i})))},transformStyle(){return`transform: translate3d(0, ${this.currentScroll}px, 0);`},slideLimitDistance(){return this.slideLimitNum*this.itemHeight}},watch:{data(t){return this.updateCurrent(),t},current(t){return this.updateCurrent(),t},currentIndex:{handler(t){this.$emit("currentIndexChanged",t)},deep:!0}},created(){},mounted(){e(this,".press-picker-view--item__active").then((t=>{this.itemHeight=t.height,this.updateCurrent()})),this.updateCurrent(),document.addEventListener("mouseup",this.mouseUp)},beforeDestroy(){this.onBeforeDestroy()},beforeUnmount(){this.onBeforeDestroy()},methods:{onBeforeDestroy(){document.removeEventListener("mouseup",this.mouseUp)},mouseDown(t){document.addEventListener("mousemove",this.mouseMove),this.handleStart(t)},mouseMove(t){this.handleMove(t)},mouseUp(){document.removeEventListener("mousemove",this.mouseMove),this.handleEnd()},handleStart(t){const e=C(t);this.start=null==e?void 0:e.clientY,this.startScroll=this.currentScroll,this.lastMove=0,this.lastTime=(new Date).getTime()},handleMove(t){const e=C(t);this.move=(null==e?void 0:e.clientY)-this.start;let i=this.startScroll+this.move;i=Math.min(0,i),i=Math.max(-(this.data.length-1)*this.itemHeight,i),this.currentScroll=i;const r=Math.round(this.currentScroll/this.itemHeight);this.currentIndex=-r,this.time=(new Date).getTime(),this.time!==this.lastTime&&(this.speed=(this.move-this.lastMove)/(this.time-this.lastTime)),this.lastMove=this.move,this.lastTime=this.time},handleEnd(){if(this.hasClick)return void(this.hasClick=!1);let t=0;(new Date).getTime()-this.lastTime<this.slideTimeThreshold&&(t=this.speed*this.slideTimeThreshold/2,t=Math.min(this.slideLimitDistance,t),t=Math.max(-this.slideLimitDistance,t));let e=this.currentScroll+t;e=Math.min(0,e),e=Math.max(-(this.data.length-1)*this.itemHeight,e);const i=Math.round(e/this.itemHeight);this.currentScroll=i*this.itemHeight,this.currentIndex=-i},getCurrentItem(){return this.data[this.currentIndex]},updateCurrent(){if(this.current){const t=this.data.find((t=>t.value==this.current.value));this.currentIndex=this.data.indexOf(t),this.currentScroll=-this.currentIndex*this.itemHeight}},itemDown(t){const e=C(t);this.downX=null==e?void 0:e.clientX,this.downY=null==e?void 0:e.clientY,this.upX=null==e?void 0:e.clientX,this.upY=null==e?void 0:e.clientY},itemMove(t){const e=C(t);this.upX=null==e?void 0:e.clientX,this.upY=null==e?void 0:e.clientY},itemUp(t){const{uniqueKey:e}=t.currentTarget.dataset;this.twoPointDistance({x:this.downX,y:this.downY},{x:this.upX,y:this.upY})<10&&(this.currentIndex=e,this.currentScroll=-this.currentIndex*this.itemHeight,this.hasClick=!0)},twoPointDistance:(t,e)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),getElementIndex:t=>parseInt(t.id,10)}},[["render",function(t,e,i,p,m,v){return r(),n("div",{class:u(["press-picker-view",[i.hasTip?"press-picker-view__tip":"",i.horizontal?"press-picker-view--hor":""]]),onMousedown:e[6]||(e[6]=d(((...t)=>v.mouseDown&&v.mouseDown(...t)),["stop","prevent"])),onMouseup:e[7]||(e[7]=d(((...t)=>v.mouseUp&&v.mouseUp(...t)),["stop","prevent"])),onTouchstart:e[8]||(e[8]=d(((...t)=>v.handleStart&&v.handleStart(...t)),["stop","prevent"])),onTouchmove:e[9]||(e[9]=d(((...t)=>v.handleMove&&v.handleMove(...t)),["stop","prevent"])),onTouchend:e[10]||(e[10]=d(((...t)=>v.handleEnd&&v.handleEnd(...t)),["stop","prevent"]))},[s("div",{ref:"dropListMask",class:"press-picker-view--mask"},null,512),s("div",{ref:"dropListIndicator",class:"press-picker-view--indicator"},null,512),s("div",{ref:"DropListContent",class:"press-picker-view--content",style:a(v.transformStyle)},[o(" 选中添加类名drop-list-item-active "),s("div",{style:a(v.hiddenUpPartStyle)},null,4),(r(!0),n(l,null,h(v.showingData,((t,i)=>(r(),n("div",{key:i,class:u(["press-picker-view--item",[t.uniqueKey==m.currentIndex?"press-picker-view--item__active":""]]),"data-unique-key":t.uniqueKey,onMousedown:e[0]||(e[0]=(...t)=>v.itemDown&&v.itemDown(...t)),onMousemove:e[1]||(e[1]=(...t)=>v.itemMove&&v.itemMove(...t)),onMouseup:e[2]||(e[2]=(...t)=>v.itemUp&&v.itemUp(...t)),onTouchstart:e[3]||(e[3]=(...t)=>v.itemDown&&v.itemDown(...t)),onTouchmove:e[4]||(e[4]=(...t)=>v.itemMove&&v.itemMove(...t)),onTouchend:e[5]||(e[5]=(...t)=>v.itemUp&&v.itemUp(...t))},c(t.label),43,["data-unique-key"])))),128)),s("div",{style:a(v.hiddenBottomPartStyle)},null,4)],4)],34)}],["__scopeId","data-v-8b9ea832"]])},props:{title:{type:String,default:"",required:!1},arrowIcon:{type:Boolean,default:!1},tip:{type:String,default:"",required:!1},data:{type:Array,default:()=>[],required:!0},current:{type:Object,default:null,required:!1},virtualListThreshold:{type:Number,default:50},horizontal:{type:Boolean,default:!1}},options:{virtualHost:!0,styleIsolation:"shared"},emits:["onSelect","onCancel"],data:()=>({currentIndex:-1}),mounted(){},methods:{t:w,onCurrentIndexChanged(t){this.currentIndex=t},onConfirm(){var t,e;(null==(t=this.$refs)?void 0:t.picker)?this.$emit("onSelect",this.$refs.picker.getCurrentItem()):this.$emit("onSelect",null==(e=this.data)?void 0:e[this.currentIndex])},onCancel(){this.$emit("onCancel")}}},[["render",function(t,e,i,s,a,l){const h=f("PressPickerView"),d=f("PressPopup");return r(),p(d,{"close-icon":!i.arrowIcon,"show-back-arrow":i.arrowIcon,title:i.title,button:l.t("picker.confirm"),mode:"white",horizontal:i.horizontal,"width-number":54,"popup-class":"press-popup-picker",class:u(i.tip?"press-picker__tip":""),onCancel:l.onCancel,onConfirm:l.onConfirm},{default:m((()=>[i.tip?(r(),n("div",{key:0,class:"press-picker--tip"},c(i.tip),1)):o("v-if",!0),v(h,{ref:"picker",data:i.data,"has-tip":!!i.tip,current:i.current,horizontal:i.horizontal,"virtual-list-threshold":i.virtualListThreshold,onCurrentIndexChanged:l.onCurrentIndexChanged},null,8,["data","has-tip","current","horizontal","virtual-list-threshold","onCurrentIndexChanged"])])),_:1},8,["close-icon","show-back-arrow","title","button","horizontal","class","onCancel","onConfirm"])}],["__scopeId","data-v-85a5fd68"]])},mixins:[g(y({arrowIcon:{type:Boolean,default:!1},title:{type:String,default:""},list:{type:Array,default:()=>[],required:!1},current:{type:Object,default:null,required:!1},tip:{type:String,default:"",required:!1},confirm:{type:Function,default:null,required:!1},cancel:{type:Function,default:null,required:!1},virtualListThreshold:{type:Number,default:50},horizontal:{type:Boolean,default:!1}},k),{showProp:!1,propsKeyMap:k})],props:{},emits:["onClickConfirm","confirm","onRemove","cancel"],data:()=>({}),mounted(){this.isFunctionMode||this.showDialog()},methods:{onClickSelect(t){this.$emit("onClickConfirm",t),this.$emit("confirm",t),this.innerShow=!1,this.getPropOrData("confirm")&&this.getPropOrData("confirm")(t),this.promiseCallback("confirm",{item:t}),setTimeout((()=>{this.destroy()}),100)},remove(){this.$emit("onRemove"),this.$emit("cancel"),this.innerShow=!1,this.getPropOrData("cancel")&&this.getPropOrData("cancel")(),this.promiseCallback("cancel"),setTimeout((()=>{this.destroy()}),100)},destroy(){var t,e,i,r;this.isFunctionMode||(null==(t=null==this?void 0:this.$destroy)||t.call(this),document.body.contains(this.$el)&&(null==(r=null==(i=null==(e=this.$el)?void 0:e.parentElement)?void 0:i.removeChild)||r.call(i,this.$el)))}}},[["render",function(t,e,i,n,s,a){const l=f("PickerInner");return t.innerShow?(r(),p(l,{key:0,data:t.getPropOrData("list"),current:t.getPropOrData("current"),title:t.getPropOrData("title"),"arrow-icon":t.getPropOrData("arrowIcon"),tip:t.getPropOrData("tip"),"virtual-list-threshold":t.getPropOrData("virtualListThreshold"),horizontal:t.getPropOrData("horizontal"),onOnCancel:a.remove,onOnSelect:a.onClickSelect},null,8,["data","current","title","arrow-icon","tip","virtual-list-threshold","horizontal","onOnCancel","onOnSelect"])):o("v-if",!0)}]]);export{x as P};
